# API 서버

해당 서버는 **.Net Core 공부** 및 **2D Project**에서 사용될 목적으로 제작된 프로젝트입니다.  
스테이지 방식의 **던전을 클리어하는 RPG 장르**의 게임으로,  
캐릭터와 장비를 강화하며 더 높은 스테이지를 클리어하는 컨텐츠를 포함합니다.

---

## 🚀 기술 스택
- **언어** : C#
- **프레임워크** : ASP.NET Core
- **데이터베이스** : MySQL, Redis
- **DB 연결** : SQLKata, Cloud Structures
- **로거** : ZLogger
- **기타** : Docker

---

## 📑 목차
1. 컨텐츠 & API
2. 미들웨어
3. DB 스키마

---

## 📌 컨텐츠 & API

### 1. 회원가입
- 이메일 & 비밀번호를 기반으로 회원가입을 진행합니다.  
- 중복 이메일 여부를 확인 후, 새로운 계정을 생성합니다.  
- 비밀번호는 **Salt Value**를 사용하여 보안 강화 (레인보우 테이블 공격 방지).  
- 신규 계정에는 **초기 데이터(재화, 캐릭터, 아이템 등)** 가 지급됩니다.  

---

### 2. 로그인
- 계정 정보를 이용하여 로그인 시도.  
- 인증 성공 시, 내부적으로 **Session**과 **인증용 Token**을 생성 (Session은 Redis에 저장).  
- 이후 인증이 필요한 요청은 `Email(Session 조회)`과 `Token(Session 인증)`을 포함해야 하며, 미들웨어에서 검증.  
- Redis에 보관된 Session 정보는 TTL 동안 유효하며, 만료 시 재로그인이 필요합니다.  

---

### 3. 출석 
- 월 단위 출석 보상 시스템.  
- 출석 체크를 처리하고 보상을 지급합니다.  

---

### 4. 메일
- 출석 보상 등을 보관하는 **메일함 시스템**.  
- 메일함 크기에는 제한이 없으며, 페이징 단위로 데이터를 제공합니다.  
- 단건 메일 보상 수령 요청을 통해 보상을 획득할 수 있습니다.  

---

### 5. 상점
- 캐릭터, 유료 상품 등을 판매하는 상점 시스템.  
- 현재는 **캐릭터만 판매**합니다.  

---

### 6. 스테이지
- 유저의 스테이지 **입장 → 진행 → 클리어** 과정을 처리합니다.  
- 입장 시 선택한 캐릭터 정보는 Redis에 기록됩니다.  
- 진행 중 몬스터 처치 등 갱신 사항은 Redis에 업데이트됩니다.  
- 클리어 시 보상은 바로 지급 (메일이 아닌 즉시 데이터 반영).  
- 실패 시 보상은 지급되지 않습니다.  

---

### 7. 인벤토리
- 유저의 **캐릭터/아이템/룬**을 관리하는 시스템.  
- 캐릭터는 전체 리스트 조회 가능.  
- 아이템/룬은 **페이징 조회** 지원.  

---

### 8. 강화
- 캐릭터/아이템/룬에 대해 강화를 진행할 수 있습니다.  
- 강화에는 **재화가 소모**되며, 실패 확률은 없습니다.  

---

### 9. 퀘스트
- 일정 목표 달성 시 보상을 제공하는 시스템.  
- 진행/완료 목록은 페이징 조회 가능.  
- 단건 퀘스트 보상 획득 요청 가능.  
- 퀘스트 진행도는 관련 행동 시 서버 내부에서 자동 처리됩니다.  

---

## ⚙️ 미들웨어

### 1. 세션 체크
- 세션 인증이 필요하지 않은 경우 생략 (예: 로그인, 회원가입).  
- 세션 인증이 필요한 경우, Request에서 `Email`과 `AuthToken`을 조회하여 인증합니다.  
- 인증에 실패한 경우 에러를 반환합니다.  

---

### 2. 세션 락 처리
- 한 세션에 대해 요청을 동시에 **1번까지만** 받도록 제한합니다.  
- Redis에 세션 락을 생성한 뒤 API 요청을 처리합니다.  
- 처리 완료 후 Redis에 있는 락을 제거합니다.  

---

### 3. 응답 코드 수정
- API 요청에 대해 공통적으로 존재하는 **ErrorCode** 값을 파싱하여 응답 코드를 수정합니다.  
- ErrorCode는 `에러코드_응답코드` 방식으로 정의됩니다. (예: `5005_404`)  
- 응답 Body에는 ErrorCode의 **에러코드 부분만** 남도록 수정합니다.  

---

## 🗄️ DB 스키마
📂 [DB 스키마 확인하기](스키마.md)
